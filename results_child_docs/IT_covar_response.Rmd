## Information Theory (IT) covariates 

GAMs for breeding wader abundance response across the five different species were generated from 2002â€“10 and 2011-19. They included five IT covariates, and the model parameters for all species across the two response periods can be seen in Appendix \@ref(gam-it-resp-params). A third model was generated by taking the abundance response from the first two models to generate the ratio of population change between the two response periods, the model parameters for this model can be seen in Appendix \@ref{#gam-it-pop-chg-params}.

### Histograms of Information theory covariates

Histograms of IT covariates using the EUNIS landscape categorisation, across all of Shetland are shown in figure \@ref(fig:itHisto). The *marginal entropy* for the Shetland landscape is approximately normally distributed, indicating that habitat within the Shetland landscape is spatially diverse but that very low and highly diverse habitat within Shetland are relatively rare. The mode of the *conditional entropy* is relatively low with a distribution that shows significant positive skew; this suggests that the Shetland landscape has relatively low geometric intricacy. This arises when cells of one category within a landscape raster are predominantly adjacent to cells of the same category. The overall spatio-thematic complexity is measured by *joint entropy*. This can be thought of as quantifying the uncertainty in determining the habitat type of a focus cell and an adjacent cell. For Shetland, joint entropy appears to be approximately normally distributed. This indicates that habitat with very high or low spatio-thematic complexity is relatively rare on Shetland. Due to the spatial autocorrelation, the value of *mutual information* tends to grow with a diversity of the landscape (marginal entropy). To adjust this tendency, it is possible to calculate *relative mutual information* by dividing the mutual information by the marginal entropy. Relative mutual information always has a range between 0 and 1, and quantifies the degree of aggregation of spatial habitat. It can be seen that for Shetland, relative mutual information is distributed with significant negative skew. This implies that habitat types across Shetland are predominantly aggregated - small relatively information values indicate significant fragmentation in landscape habitat patterns.

```{r itHisto, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.asp= 1, fig.cap='Histograms of Information Theory covariates across all Shetland OS 1km squares'}
# Plot histogram
histo_covars %>%
  # pivot long by IT metrics
  pivot_longer(cols=c('Marginal entropy':'Relative mutual informaton'), 
               names_to = "covar",
               values_to = "value") %>%
  # Remove zero values as this makes it hard to see the distribution
  filter(value >0) %>%
  ggplot(aes(x = value)) + 
  # plot the histogram
  stat_bin(color = "black", bins=20) +
  theme_minimal() +
  labs(x = "Information Theory covariate", y = "Frequency") +
  facet_wrap(~covar, ncol=2, scales="free")
```

### Histograms of Information Theory covariates for surveyed squares only

1km squares surveyed as part of the Shetland BBS were used to generate IT covariates histograms using the EUNIS landscape categorisation, as shown in Figure \@ref(fig:itSBBSHisto). Here we can see that the *conditional entropy* and the *marginal entropy* across all surveyed squares had a mode that was significantly higher than the Shetland wide values shown in Figure \@ref(fig:itHisto). There is also significantly less negative negative skew in the *relative mutual information* of the surveyed squares. 

```{r itSBBSHisto, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.asp= 1, fig.cap='Histograms of Information Theory covariates across SBBS surveyed sqaures only '}
# Load covar data for surveyed BBS squares
bbs_covars <- surveyed_PLAN_NO %>% 
  dplyr::left_join(histo_covars, by="PLAN_NO") %>%
  na.omit() %>%
  st_drop_geometry()

# Plot histogram
bbs_covars %>%
  # pivot long by sIT metrics
  pivot_longer(cols=c('Marginal entropy':'Relative mutual informaton'), 
               names_to = "covar",
               values_to = "value") %>%
  # Remove zero values as this makes it hard to see the distribution
  filter(value >0) %>%
  ggplot(aes(x = value)) + 
  # plot the histogram
  stat_bin(color = "black", bins=20) +
  theme_minimal() +
  labs(x = "Environmental covariate", y = "Frequency") +
  facet_wrap(~covar, ncol=2, scales="free")

```

### Information Theory covariates abundance response model

```{r itGam,  message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.asp= 1, fig.cap='Information Metrics as covariates for abundance response'}

it_wader_df <- wader_covars_df %>% 
  # Structure data by covariate and then group
  # pivot long by sIT metrics
  pivot_longer(cols=c('Marginal entropy':'Relative mutual informaton'), 
               names_to = "covariate",
               values_to = "value") %>%
  group_by(period, Species, covariate) %>%
  nest() %>%
  mutate(model = map2(.x = data,
                      .y = period,
                      # Generate a univariate GAM model for wader count against covariate (value).
                      # Repeat for each combination of wader and covariate 
                      ~ gam(count_sm ~ s(X,Y, k=20) + value,
                                      # Apply a different offset depending on whether this gam
                                      # models population change or only covariate response
                                      offset = case_when(.y == "2002-2019" ~ log(count_offset), 
                                                         .y != "2002-2019" ~ log(d) + log(9)),
                                      family = poisson(link="log"),
                                      method = "REML",
                                      data = .x)),
    # Summarise model config for reporting
  model_smry = map(model, ~tidy(.,parametric=TRUE)  )) %>%
  unnest(cols=model_smry) %>%
  filter(term != "(Intercept)") %>%
  dplyr::select(-term)

```

GAMs using IT metrics as covariates against breeding wader abundance data were generated for each analysis period. Figures \@ref(fig:itHeatMap200210) and \@ref(fig:itHeatMap201119) summarise the associations between the abundance response and IT covariates used in the univariate GAMs, for the periods 2002-10 and 2011-19 respectively.

```{r itHeatMap200210, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.cap='Summary of associations between breeding wader density and IT covariates, between 2002 and 2010 inclusive'}
it_species_assoc_2002_10 <- data.frame(
  Covariate = c('Marginal entropy',
                'Conditional entropy',
                'Joint entropy',
                'Mutual information',
                'Relative mutual inforation'),
  CU = c("NS","NS","NS","NS","Pos"),
  L =  c("Pos","NS","NS","Pos","Pos"),
  OC = c("NS","Neg","NS","Pos","Pos"),
  RK = c("Pos","NS","Pos","Pos","Pos"),
  SN = c("Neg","Neg","Neg","Neg","Pos")
  )%>%
  pivot_longer(cols = CU:SN, names_to = "Species", values_to ="Association")

it_species_assoc_2002_10 %>% 
  ggplot(mapping = aes(x = Species, y = Covariate, fill = Association)) +
  geom_tile(colour="white") + 
  scale_fill_manual(values=c("grey", "red", "blue")) +
  theme_minimal()
```

```{r itHeatMap201119, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.cap='Summary of associations between breeding wader density and IT covariates, between 2011 and 2019 inclusive'}
it_species_assoc_2011_19 <- data.frame(
  Covariate = c('Marginal entropy',
                'Conditional entropy',
                'Joint entropy',
                'Mutual information',
                'Relative mutual inforation'),
  CU = c("Pos","Pos","Pos","Pos","NS"),
  L =  c("Pos","Pos","Pos","Pos","NS"),
  OC = c("Pos","NS","Pos","Pos","NS"),
  RK = c("Pos","Pos","Pos","Pos","NS"),
  SN = c("Neg","Neg","Neg","Neg","Pos")
  )%>%
  pivot_longer(cols = CU:SN, names_to = "Species", values_to ="Association")

it_species_assoc_2011_19 %>% 
  ggplot(mapping = aes(x = Species, y = Covariate, fill = Association)) +
  geom_tile(colour="white") + 
  scale_fill_manual(values=c("grey", "red", "blue")) +
  theme_minimal()
```
Appendix \@ref(gam-it-resp-params) shows the GAM parameters generated by fitting the model to the data when information theory metrics are used as covariates. Plots showing the abundance response against IT covariates are shown in Appendix \@ref(gam-it-resp-plots).

### Population change model against IT covarirates

By using the response of the 2002-2010 wader densities as the offset for the 2011-19 densities, a third series of GAMs were fitted to show the ratio of population change in response to environmental covariates. This is summarised in Figure \@ref(fig:itHeatMapPopChg). It can be seen that there are no statistically significant results for Redshank or Snipe, or for marginal entropy as a covariate.

```{r itHeatMapPopChg, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', fig.cap='Summary of associations between breeding wader density and IT covariates, between 2011 and 2019 inclusive'}
it_pop_chg_2011_19 <- data.frame(
  Covariate = c('Marginal entropy',
                'Conditional entropy',
                'Joint entropy',
                'Mutual information',
                'Relative mutual inforation'),
  CU = c("NS","Pos","Pos","NS","NS"),
  L =  c("NS","Pos","Pos","NS","Neg"),
  OC = c("NS","Pos","Pos","NS","Neg"),
  RK = c("NS","NS","NS","NS","NS"),
  SN = c("NS","NS","NS","NS","NS")
  )%>%
  pivot_longer(cols = CU:SN, names_to = "Species", values_to ="Association")

it_pop_chg_2011_19 %>% 
  ggplot(mapping = aes(x = Species, y = Covariate, fill = Association)) +
  geom_tile(colour="white") + 
  scale_fill_manual(values=c("grey", "red", "blue")) +
  theme_minimal()
```
Appendix \@ref(gam-it-pop-chg-params) shows the GAM parameters generated by fitting the population change model to the data. Plots for population change response against IT covariates are shown in Figure \@ref(gam-it-pop-chg-plots).

